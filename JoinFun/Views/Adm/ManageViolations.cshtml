@model JoinFun.ViewModel.AdmView

@{
    ViewBag.Title = "違規管理";
    Layout = "~/Views/Shared/_Layout2.cshtml";
}

<h2 class="text-warning text-center">違規管理</h2>

<div class="tab-content">
    <input id="load" type="hidden" value="@ViewBag.ID" />
    <div class="tab-pane fade show" id="memList">
        <button type="button" class="btn btn-outline-primary" id="one">1個月內已處理違規紀錄</button>
        <button type="button" class="btn btn-outline-primary" id="three">3個月內已處理違規紀錄</button>
        <button type="button" class="btn btn-outline-primary" id="six">6個月內已處理違規紀錄</button>
        <table class="table table-striped table-hover table-responsive-sm">
            <caption>會員違規列表</caption>
            <thead class="thead-dark text-center">
                <tr>
                    <th scope="col">違規編號</th>
                    <th scope="col">檢舉人</th>
                    <th scope="col">違規類別</th>
                    <th scope="col">違規標題</th>
                    <th scope="col">違規時間</th>
                    <th scope="col">目前狀態</th>
                </tr>
            </thead>
            <tbody class="text-center">
                @if (Model.violateList.Where(m => m.CorrespondingEventID.StartsWith("M")) != null)
                {
                    foreach (var item in Model.violateList.Where(m => m.CorrespondingEventID.StartsWith("M")))
                    {
                        <tr class="table-warning">
                            <td>
                                @item.vioId
                            </td>
                            <td>
                                @if (item != null)
                                {
                                    if (item.FromMemId != null)
                                    {
                                        foreach (var m in Model.memList.Where(x => x.memId == item.FromMemId))
                                        {
                                            @m.memNick
                                        }
                                    }
                                    else
                                    {
                                        foreach (var a in Model.admin.Where(a => a.admId == item.FromAdmID))
                                        {
                                            @a.admNick
                                        }
                                    }
                                }
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.CorrespondingEventID)
                            </td>
                            <td>
                                <form method="get" action="@Url.Action("ViolationContent")">
                                    <input id="vioID" name="vioID" type="hidden" value="@item.vioId" />
                                    <input id="Page" name="Page" type="hidden" value="memList" />
                                    <input id="vioContent" type="submit" value="@item.vioTitle" class="btn btn-link" />
                                </form>
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.vioReportTime)
                            </td>
                            <td class="text-danger">未處理</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <div class="tab-pane fade" id="remarkList">
        <button type="button" class="btn btn-outline-primary" id="one">1個月內已處理違規紀錄</button>
        <button type="button" class="btn btn-outline-primary" id="three">3個月內已處理違規紀錄</button>
        <button type="button" class="btn btn-outline-primary" id="six">6個月內已處理違規紀錄</button>
        <table class="table table-striped table-hover table-responsive-sm">
            <caption>不實評價列表</caption>
            <thead class="thead-dark text-center">
                <tr>
                    <th scope="col">違規編號</th>
                    <th scope="col">檢舉人</th>
                    <th scope="col">違規類別</th>
                    <th scope="col">違規標題</th>
                    <th scope="col">違規時間</th>
                    <th scope="col">目前狀態</th>
                </tr>
            </thead>
            <tbody class="text-center">
                @if (Model.violateList.Where(m => m.CorrespondingEventID.StartsWith("R")) != null)
                {
                    foreach (var item in Model.violateList.Where(m => m.CorrespondingEventID.StartsWith("R")))
                    {
                        <tr class="table-primary">
                            <td>
                                @item.vioId
                            </td>
                            <td>
                                @if (item != null)
                                {
                                    if (item.FromMemId != null)
                                    {
                                        foreach (var m in Model.memList.Where(x => x.memId == item.FromMemId))
                                        {
                                            @m.memNick
                                        }
                                    }
                                    else
                                    {
                                        foreach (var a in Model.admin.Where(a => a.admId == item.FromAdmID))
                                        {
                                            @a.admNick
                                        }
                                    }
                                }
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.CorrespondingEventID)
                            </td>
                            <td>
                                <form method="get" action="@Url.Action("ViolationContent")">
                                    <input id="vioID" name="vioID" type="hidden" value="@item.vioId" />
                                    <input id="Page" name="Page" type="hidden" value="remarkList" />
                                    <input id="vioContent" type="submit" value="@item.vioTitle" class="btn btn-link" />
                                </form>
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.vioReportTime)
                            </td>
                            <td class="text-danger">未處理</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <div class="tab-pane fade" id="actList">
        <button type="button" class="btn btn-outline-primary" id="one">1個月內已處理違規紀錄</button>
        <button type="button" class="btn btn-outline-primary" id="three">3個月內已處理違規紀錄</button>
        <button type="button" class="btn btn-outline-primary" id="six">6個月內已處理違規紀錄</button>
        <table class="table table-striped table-hover table-responsive-sm">
            <caption>違規活動列表</caption>
            <thead class="thead-dark text-center">
                <tr>
                    <th scope="col">違規編號</th>
                    <th scope="col">檢舉人</th>
                    <th scope="col">違規類別</th>
                    <th scope="col">違規標題</th>
                    <th scope="col">違規時間</th>
                    <th scope="col">目前狀態</th>
                </tr>
            </thead>
            <tbody class="text-center">
                @if (Model.violateList.Where(m => m.CorrespondingEventID.StartsWith("A")) != null)
                {
                    foreach (var item in Model.violateList.Where(m => m.CorrespondingEventID.StartsWith("A")))
                    {
                        <tr class="table-info">
                            <td>
                                @item.vioId
                                @*<input id="vioID1" type="hidden" name="vioID1" value="@item.vioId" />*@
                            </td>
                            <td>
                                @if (item != null)
                                {
                                    if (item.FromMemId != null)
                                    {
                                        foreach (var m in Model.memList.Where(x => x.memId == item.FromMemId))
                                        {
                                            @m.memNick
                                        }
                                    }
                                    else
                                    {
                                        foreach (var a in Model.admin.Where(a => a.admId == item.FromAdmID))
                                        {
                                            @a.admNick
                                        }
                                    }
                                }
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.CorrespondingEventID)
                            </td>
                            <td>
                                <form method="get" action="@Url.Action("ViolationContent")">
                                    <input id="vioID" name="vioID" type="hidden" value="@item.vioId" />
                                    <input id="Page" name="Page" type="hidden" value="actList" />
                                    <input id="vioContent" type="submit" value="@item.vioTitle" class="btn btn-link" />
                                </form>
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.vioReportTime)
                            </td>
                            <td class="text-danger">未處理</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>

    <div class="tab-pane fade" id="commentList">
        <button type="button" class="btn btn-outline-primary" id="one">1個月內已處理違規紀錄</button>
        <button type="button" class="btn btn-outline-primary" id="three">3個月內已處理違規紀錄</button>
        <button type="button" class="btn btn-outline-primary" id="six">6個月內已處理違規紀錄</button>
        <table class="table table-striped table-hover table-responsive-sm">
            <caption>不當留言列表</caption>
            <thead class="thead-dark text-center">
                <tr>
                    <th scope="col">違規編號</th>
                    <th scope="col">檢舉人</th>
                    <th scope="col">違規類別</th>
                    <th scope="col">違規標題</th>
                    <th scope="col">違規時間</th>
                    <th scope="col">目前狀態</th>
                </tr>
            </thead>
            <tbody class="text-center">
                @if (Model.violateList.Where(m => m.CorrespondingEventID.StartsWith("B")) != null)
                {
                    foreach (var item in Model.violateList.Where(m => m.CorrespondingEventID.StartsWith("B")))
                    {
                        <tr class="table-success">
                            <td>
                                @item.vioId
                            </td>
                            <td>
                                @if (item != null)
                                {
                                    if (item.FromMemId != null)
                                    {
                                        foreach (var m in Model.memList.Where(x => x.memId == item.FromMemId))
                                        {
                                            @m.memNick
                                        }
                                    }
                                    else
                                    {
                                        foreach (var a in Model.admin.Where(a => a.admId == item.FromAdmID))
                                        {
                                            @a.admNick
                                        }
                                    }
                                }
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.CorrespondingEventID)
                            </td>
                            <td>
                                <form method="get" action="@Url.Action("ViolationContent")">
                                    <input id="vioID" name="vioID" type="hidden" value="@item.vioId" />
                                    <input id="Page" name="Page" type="hidden" value="commentList" />
                                    <input id="vioContent" type="submit" value="@item.vioTitle" class="btn btn-link" />
                                </form>
                            </td>
                            <td>
                                @Html.DisplayFor(modelItem => item.vioReportTime)
                            </td>
                            <td class="text-danger">未處理</td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
    <div class="tab-pane fade show" id="doneList">
        <table class="table table-striped table-hover table-responsive-sm">
            <caption></caption>
            <thead class="thead-dark text-center">
                <tr>
                    <th scope="col">違規編號</th>
                    <th scope="col">檢舉人</th>
                    <th scope="col">類別編號</th>
                    <th scope="col">違規標題</th>
                    <th scope="col">違規時間</th>
                    <th scope="col">目前狀態</th>
                    <th scope="col">處置時間</th>
                </tr>
            </thead>
        </table>
    </div>
</div>
@section topCSS{
    <link href="~/Content/MyStyle.css" rel="stylesheet" />
}
<script src="~/Scripts/dateFormat.js"></script>
@section scripts{
    <script>
        $(document).ready(function () {
            if ($('#load').val() == "")
                $('#memList').addClass('show').addClass('active')
            var loading = $('#load').val();
            $('#vioArea').show();
            $('#' + loading).addClass('show').addClass('active');
        });''

        $('#vioArea a').click(function () {
            $('#doneList').removeClass('active');
        });


        $('#memList').find(':button').click(function () {
            getRecords('memList', $(this).attr('id'));
        });

        $('#remarkList').find(':button').click(function () {
            getRecords('remarkList', $(this).attr('id'));
        });

        $('#actList').find(':button').click(function () {
            getRecords('actList', $(this).attr('id'));
        });

        $('#commentList').find(':button').click(function () {
            getRecords('commentList', $(this).attr('id'));
        });

        function getRecords(tid, bid) {
            var value;
                switch (bid) {
                    case "one":
                        value = -1;
                        break;
                    case "three":
                        value = -3;
                        break;
                    case "six":
                        value = -6;
                        break;
                };
                $.ajax({
                url: "@Url.Action("ShowByMonths","Adm")",
                type: "get",
                data: {type: tid, month: value },
                dataType: "Json",
                    success: function (data) {
                    $('#doneList tbody').remove();
                    $('#doneList').addClass('active');
                    if (data == "")
                        $('#doneList table').append('<tbody class="text-center text-light"><tr><td colspan="7" class="mCenter">無任何紀錄</td></tr></tbody>');
                    else
                        $.each(data, function (key, value) {
                            $('#doneList table').append(`<tbody class="text-center text-light"><tr><td>${value.id}</td><td>${value.name}</td><td>${value.typeId}</td><td><a href='/Adm/ViolationContent?vioID=${value.id}&eventID=${value.type}&Page=${tid}'>${value.title}</a></td>
                                                         <td>${$.format.toBrowserTimeZone((new Date(parseInt(value.vioTime.replace("/Date(", "").replace(")/", ""), 10))))}</td><td class="text-success">${value.condition}</td>
                                                         <td>${$.format.toBrowserTimeZone((new Date(parseInt(value.doneTime.replace("/Date(", "").replace(")/", ""), 10))))}</td></tr></tbody >`);
                    });
                    $('#doneList caption').text('已處理會員違規紀錄');
                },
                error: function () {
                    $('#doneList table').append('<tbody class="text-center text-light"><tr><td colspan="7" class="mCenter">無任何紀錄</td></tr></tbody>');
                }
            });
        };
    </script>
}