@model JoinFun.Models.Acc_Pass

@{
    ViewBag.Title = "登入";
}
@section memberinfo{
    <link href="~/CSS/Register.css" rel="stylesheet" />
}

<div class="container ">
    <div  class="row justify-content-center align-content-center" style="height:80vh">
        <div class="bg-morandi rounded" style="height:570px;width:400px">
            <h2 class=" text-center pt-5 ">登入</h2>
            <form id="login" class=" ml-5  " method="post" action="@Url.Action("Login")">
                @*<div class="row justify-content-center  ">
                        <div class="form-group ">
                            <div class="row mt-3 mr-2">
                                <label class="col-md-3 col-form-label   col-sm-3" for="account">帳號:</label>
                                <div class="col-md-9  col-sm-9">
                                    <input id="account" name="account" type="text" class="form-control  " required placeholder="Enter Your Account...." />
                                </div>
                                <div>

                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center ">
                        <div class="form-group ">
                            <div class="row mt-3 mr-2">
                                <label class="col-md-3 col-form-label   col-sm-3" for="pass">密碼:</label>
                                <div class="col-md-9 col-sm-9">
                                    <input id="pass" name="pass" type="password" class="form-control  " required />
                                    <small class="form-text text-muted"><a href="@Url.Action("ForgetPwd","Register")">忘記密碼</a></small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row justify-content-center mt-4">
                        <h5 class="text-danger">@ViewBag.LoginErr</h5>
                    </div>

                    <div class="row justify-content-center">
                        @*<div class="form-group form-check">
                                <input id="remember" type="checkbox" class="form-check-input" />
                                <label for="remember">記住我</label>
                            </div> <!---->
                        <div>
                        <div class="form-group">
                            <div class="col-md-12 ">
                                <div class="mt-3 mr-4">
                                    <input id="Submit1" type="submit" value="登入" class="btn btn-primary btn-block" />
                                </div>
                                <div class="mt-3 mr-4">
                                    <input id="Reset1" type="reset" value="重設" class="btn btn-light btn-block form-control" />
                                </div>
                                <div class="mt-3 mr-4">
                                    @Html.ActionLink("註冊", "Register", "Register", "", new { @class = "btn btn-warning d-block" })
                                </div>
                            </div>
                        </div>
                    </div>*@

                <div class="row justify-content-center">
                    <div class="col-md-12 ml-4 ch-font">
                        <label class=" col-form-label   pr-1" for="account">帳號:</label>
                        <div class=" pl-0">
                            <input id="account" name="account" type="text" class="form-control  " required placeholder="Enter Your Account...." />
                        </div>
                        <div>

                        </div>
                    </div>

                    <div class="col-md-12 ml-4 ch-font">
                        <label class=" col-form-label   pr-1" for="pass">密碼:</label>
                        <div class=" pl-0">
                            <input id="pass" name="pass" type="password" class="form-control  " required />
                            <small class="form-text text-muted"><a href="@Url.Action("ForgetPwd","Register")">忘記密碼</a></small>
                        </div>
                    </div>
                    <div class="row mt-3 mr-4 ch-font">
                        <h5 class="text-danger">@ViewBag.LoginErr</h5>
                    </div>

                    <div class="col-md-12  ml-4 mt-3 ">
                        <div class="col-form-label   pr-1 ml-3 ">
                            <input id="Submit1" type="submit" value="登入" class="btn btn-primary btn-block w-75 ch-font" />
                        </div>
                        <div class="col-form-label   pr-1 ml-3 ">
                            <input id="Reset1" type="reset" value="重設" class="btn btn-light btn-block  w-75 ch-font" />
                        </div>
                        <div class="col-form-label   pr-1 ml-3 ch-font">
                            @Html.ActionLink("註冊", "Register", "Register", "", new { @class = "btn btn-warning btn-block w-75 " })
                        </div>
                    </div>

                    <div class="col-md-12 mt-1 ml-4">
                        <div class="col-form-label pr-1 ml-3 ch-font">
                            <button id="FB_login" class="ui facebook button btn-block w-75 fb-bg form-control text-white">
                                <i class="fab fa-facebook-f"></i>
                                <span class="ch-font">　使用Facebook登入</span>
                            </button>
                        </div>
                    </div>

                </div>
                <input id="socialID" type="hidden" />

            </form>
        </div>
    </div>
</div>




@section scripts{
    <script src="~/Scripts/jquery-3.4.1.min.js"></script>
    <script>
        window.fbAsyncInit = function () {
            FB.init({
                appId: '679500922527245', // 填入 FB APP ID
                cookie: true,
                xfbml: true,
                version: 'v3.2'
            });

            FB.getLoginStatus(function (response) {
                statusChangeCallback(response);
                //console.log(response);
            });
        };

        
        var id = "";
        // 處理各種登入身份
        function statusChangeCallback(response) {
            

            // 登入 FB 且已加入會員
            if (response.status === 'connected') {
                FB.api('/me?fields=id,name,email', function (response) {
                    id = response.id;
                    email = response.email;
                    //console.log(id,email);
                    checkIsMember(id,email);
                });
            }

            //登入 FB, 未偵測到加入會員
            else if (response.status === "not_authorized") {
                //target.innerHTML = "已登入 FB，但未加入 JoinFun 應用程式";
            }

            // 未登入 FB
            else {
                //target.innerHTML = "未登入 FB";
            }
        }

        function checkLoginState() {
            FB.getLoginStatus(function (response) {
                //statusChangeCallback(response);
                console.log(response);
            });
        }
        function fblogout() {     // facebook 登出
            FB.getLoginStatus(
                function (response) {
                    if (response.status === 'connected') {
                        FB.logout(function (response) {    //使用者已成功登出
                            alert("成功登出。");
                            localStorage.clear();
                            //再 refresh 一次，讓登入登出按鈕能正常顯示
                            //statusChangeCallback(response);
                            location.replace("http://localhost:54129/Activity");
                        });
                    } else if (response.status === 'not_authorized') {
                        // 使用者已登入 Facebook，但是在你的app是無效的
                        FB.logout(function (response) {     // 使用者已登出
                            alert("請重新登入！");
                            //statusChangeCallback(response);
                        });
                    } else {    // 使用者沒有登入 Facebook
                        alert("請重新登入！");
                        //statusChangeCallback(response);
                    }
                });
        }
        // 載入 FB SDK
        (function (d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0];
            if (d.getElementById(id)) return;
            js = d.createElement(s);
            js.id = id;
            js.src = "https://connect.facebook.net/zh_TW/sdk.js";
            fjs.parentNode.insertBefore(js, fjs);
        }(document, 'script', 'facebook-jssdk'));
         // 點擊登入按鈕
        $("#FB_login").click(function () {
            FB.login(function (response) {
                statusChangeCallback(response);
                
            }, {
                scope: 'public_profile,email'
            });
        });
    function checkIsMember(sid,email) {
        window.location.href = "http://localhost:54129/Login/FbLogin?ID=" + sid+"&email="+email;
    }
    </script>
}

